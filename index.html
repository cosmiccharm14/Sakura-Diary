<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸŒ¸ My Diary ğŸŒ¸</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');

:root{
--pink-btn: #f8c8dc; /* note-area buttons */
--pink-text: #d16b8c;
--line-color: #db84a9;
--m-ğŸ˜†: #e69ded;
--m-ğŸ˜­: #9d9ded;
--m-ğŸ˜´: #9dd4ed;
--m-ğŸ¤®: #9deda9;
--m-ğŸ˜Š: #ede69d;
--m-ğŸ˜«: #edb89d;
--m-ğŸ˜¡: #ed9e9d;
}

html,body{
height:100%;
margin:0;
font-family: 'Pacifico', cursive;
background: url('assets/Background.png') no-repeat center center fixed;
background-size: cover;
-webkit-font-smoothing:antialiased;
-moz-osx-font-smoothing:grayscale;
color: var(--pink-text);
overflow-x:hidden;
}

/* subtle global blur on bg via overlay */
body::before{
content:"";
position:fixed;
inset:0;
backdrop-filter: blur(2px);
pointer-events:none;
z-index:0;
}

/* Petals / flowers are appended to body so above overlay; z-index high */
.falling {
position:fixed;
z-index:999;
pointer-events:none;
width:48px;
height:auto;
will-change: transform, opacity;
opacity:0.95;
}

/* header */
.header-box {
width: fit-content;
padding: 15px 35px;
margin: 18px auto;
border-radius: 20px;
background: rgba(255,180,200,0.55);
backdrop-filter: blur(4px);
font-size: 40px;
color: var(--pink-text);
box-shadow: 0 0 15px rgba(255,150,190,0.6);
text-align:center;
position:relative;
z-index:10;
}

.container{
width:90%;
max-width:900px;
margin: 14px auto 80px auto;
padding: 12px;
position:relative;
z-index:10;
}

.section{
background: rgba(255,180,210,0.55);
backdrop-filter: blur(4px);
border-radius: 18px;
padding: 14px;
margin-bottom: 16px;
}

.section-header{
display:flex;
justify-content:space-between;
align-items:center;
gap:8px;
flex-wrap:wrap;
}

.section-title{
font-size:22px;
color:var(--pink-text);
outline:none;
}

/* buttons (note area) */
.rename-btn, .toggle-btn, .add-note-btn, .delete-btn, .note-delete, .add-mood-btn {
background: var(--pink-btn);
border: 2px solid var(--pink-btn);
border-radius:10px;
padding:6px 10px;
font-family:'Pacifico', cursive;
font-size:15px;
color: var(--pink-text);
cursor:pointer;
}

.notes { margin-top:12px; }

/* lined notebook style: repeating horizontal lines using the user's color */
.note {
position:relative;
border-radius:16px;
padding:18px 18px;
margin-top:10px;
box-sizing:border-box;
background:
repeating-linear-gradient(
to bottom,
rgba(255,215,230,0.55),
rgba(255,215,230,0.55) 27px,
var(--line-color) 28px
);
font-size:18px;
line-height:28px;
color:var(--pink-text);
min-height:56px;
overflow-wrap:break-word;
}

.note-content{
background:transparent;
outline:none;
border:none;
min-height:40px;
color:var(--pink-text);
}

.note-delete{ position:absolute; top:8px; right:10px; }

/* Mood calendar */
.mood-calendar-container{
background: rgba(255,180,200,0.55);
backdrop-filter: blur(4px);
border-radius:20px;
padding:18px;
margin-top:20px;
text-align:center;
}

.mood-selector{
display:flex;
gap:10px;
flex-wrap:wrap;
justify-content:center;
align-items:center;
margin-bottom:12px;
}

.mood-selector select, .mood-selector input{
font-family:'Pacifico', cursive;
font-size:16px;
padding:6px 10px;
border-radius:10px;
border:2px solid #fcbbd1;
background: rgba(255,215,230,0.75);
color:var(--pink-text);
}

.calendar-header{
display:flex;
justify-content:center;
gap:14px;
align-items:center;
margin-bottom:10px;
}

.calendar-header button{
background:var(--pink-btn);
border:2px solid var(--pink-btn);
border-radius:12px;
padding:6px 10px;
font-family:'Pacifico', cursive;
font-size:18px;
color:var(--pink-text);
cursor:pointer;
}

.calendar-grid{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:6px;
margin-top:6px;
}

.day, .day-name{
min-height:60px;
border-radius:12px;
background: rgba(255,255,255,0.25);
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
color:var(--pink-text);
font-size:16px;
}

.day-name{ font-weight:700; }

.mood-emoji{
font-size:20px;
margin:2px;
padding:4px 6px;
border-radius:50%;
cursor:pointer;
color:#ffffff;
}

/* pie */
#pie-container{
width:260px;
height:260px;
margin:14px auto 0 auto;
}

/* small responsive tweaks */
@media (max-width:640px){
.header-box{ font-size:32px; padding:12px 20px; }
.container{ padding:10px; }
.day, .day-name{ min-height:52px; font-size:14px; }
} </style>

</head>
<body>

  <div class="header-box">ğŸŒ¸ My Diary ğŸŒ¸</div>

  <div class="container">
    <div id="sections"></div>
    <button class="add-note-btn" onclick="addSection()">+ Add Section</button>

```
<div class="mood-calendar-container">
  <div class="mood-selector">
    <select id="moodSelect" aria-label="Select mood">
      <option value="ğŸ˜†">ğŸ˜†</option>
      <option value="ğŸ˜­">ğŸ˜­</option>
      <option value="ğŸ˜´">ğŸ˜´</option>
      <option value="ğŸ¤®">ğŸ¤®</option>
      <option value="ğŸ˜Š">ğŸ˜Š</option>
      <option value="ğŸ˜«">ğŸ˜«</option>
      <option value="ğŸ˜¡">ğŸ˜¡</option>
    </select>

    <input id="moodNote" placeholder="Add a note..." />

    <button class="add-mood-btn" onclick="addMood()">Add Mood</button>
    <button class="add-mood-btn" onclick="togglePie()">Mood Chart</button>
  </div>

  <div class="calendar-header">
    <button onclick="prevMonth()">â®</button>
    <div id="monthYear"></div>
    <button onclick="nextMonth()">â¯</button>
  </div>

  <div class="calendar-grid" id="calendar"></div>

  <div id="pie-container" style="display:none">
    <canvas id="moodPie"></canvas>
  </div>
</div>
```

  </div>

<script>
/* -------------------------
   FALLING PETALS & FLOWERS
   - uses assets/Flower.png and assets/Petal.png
   - creates elements, animates with JS + CSS transforms
   - removes node on animationend so nothing gets stuck
   -------------------------*/

const ASSET_PETAL = 'assets/Petal.png';
const ASSET_FLOWER = 'assets/Flower.png';

/* create one falling item (type: "petal"|"flower") */
function spawnFalling(type){
  const img = document.createElement('img');
  img.className = 'falling';
  img.src = (type==='flower') ? ASSET_FLOWER : ASSET_PETAL;
  // random horizontal start (avoid extreme edges)
  const pad = 6; // vw padding so they don't clip
  const x = pad + Math.random() * (94 - 2*pad); // vw
  img.style.left = x + 'vw';
  // random scale / rotation
  const scale = 0.9 + Math.random()*0.6;
  const rot = Math.floor(Math.random()*360);
  img.style.transform = `translateY(-120px) rotate(${rot}deg) scale(${scale})`;
  // give each a custom duration and sway
  const duration = 9 + Math.random()*8; // seconds
  img.dataset.duration = duration;

  // create animation using Web Animations so we can cleanup reliably
  document.body.appendChild(img);

  const endY = window.innerHeight + 160; // px, ensure goes below view
  // horizontal drift: small sway
  const drift = (Math.random()*120)-60; // px

  const anim = img.animate([
    { transform: `translateY(-120px) rotate(${rot}deg) scale(${scale})`, opacity:1 },
    { transform: `translateY(${endY}px) translateX(${drift}px) rotate(${rot+360}deg) scale(${scale})`, opacity:1 }
  ], {
    duration: duration*1000,
    easing: 'linear',
    iterations: 1,
    fill:'forwards'
  });

  // remove when done
  anim.onfinish = () => {
    img.remove();
  };
}

/* spawn bursts over time */
let petalTimer = null;
function startFalling(){
  // spawn mix of petals + occasional flower
  petalTimer = setInterval(()=>{
    // small chance to spawn a flower (bigger)
    if(Math.random() < 0.12) spawnFalling('flower');
    // spawn 1-2 petals
    spawnFalling('petal');
    if(Math.random() < 0.6) spawnFalling('petal');
  }, 900);
}
startFalling();

/* when resized, nothing special â€” next spawns use new size */

/* -------------------------
   MOOD CALENDAR + PIE CHART
   -------------------------*/

const moodColors = {
  'ğŸ˜†':'#e69ded',
  'ğŸ˜­':'#9d9ded',
  'ğŸ˜´':'#9dd4ed',
  'ğŸ¤®':'#9deda9',
  'ğŸ˜Š':'#ede69d',
  'ğŸ˜«':'#edb89d',
  'ğŸ˜¡':'#ed9e9d'
};

let moodData = JSON.parse(localStorage.getItem('moodData')||'{}');
let today = new Date();
let currentMonth = today.getMonth();
let currentYear = today.getFullYear();
let pieChart = null;

function saveMoodData(){ localStorage.setItem('moodData', JSON.stringify(moodData)); }

function addMood(){
  const emoji = document.getElementById('moodSelect').value;
  const note = document.getElementById('moodNote').value || '';
  // default date is the selected month & today's day â€” keep simple like original
  const d = today.getDate();
  const dateStr = `${currentYear}-${currentMonth+1}-${d}`;
  if(!moodData[dateStr]) moodData[dateStr]=[];
  moodData[dateStr].push({emoji,note});
  saveMoodData();
  document.getElementById('moodNote').value='';
  renderCalendar();
  updatePie();
}

function deleteMood(dateStr,index){
  if(!moodData[dateStr]) return;
  moodData[dateStr].splice(index,1);
  if(moodData[dateStr].length===0) delete moodData[dateStr];
  saveMoodData();
  renderCalendar();
  updatePie();
}

function renderCalendar(){
  const cal = document.getElementById('calendar');
  cal.innerHTML='';
  const monthYearDiv = document.getElementById('monthYear');
  const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
  monthYearDiv.innerText = `${monthNames[currentMonth]} ${currentYear}`;

  // day names
  const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  dayNames.forEach(n=>{
    const dn = document.createElement('div');
    dn.className='day-name';
    dn.innerText = n;
    cal.appendChild(dn);
  });

  const first = new Date(currentYear, currentMonth, 1).getDay();
  const days = new Date(currentYear, currentMonth+1, 0).getDate();

  // empty slots
  for(let i=0;i<first;i++) cal.appendChild(document.createElement('div'));

  for(let d=1; d<=days; d++){
    const dayDiv = document.createElement('div');
    dayDiv.className = 'day';
    const dateStr = `${currentYear}-${currentMonth+1}-${d}`;
    dayDiv.dataset.date = dateStr;

    const moodsToday = moodData[dateStr];
    if(moodsToday){
      moodsToday.forEach((m,i)=>{
        const emo = document.createElement('div');
        emo.className='mood-emoji';
        emo.innerText = m.emoji;
        emo.title = m.note;
        emo.style.background = moodColors[m.emoji] || '#ccc';
        emo.onclick = ()=> deleteMood(dateStr, i);
        dayDiv.appendChild(emo);
      });
    } else {
      dayDiv.innerText = d;
    }

    cal.appendChild(dayDiv);
  }
}

function prevMonth(){
  currentMonth--;
  if(currentMonth < 0){ currentMonth = 11; currentYear--; }
  renderCalendar();
}

function nextMonth(){
  currentMonth++;
  if(currentMonth > 11){ currentMonth = 0; currentYear++; }
  renderCalendar();
}

function togglePie(){
  const cont = document.getElementById('pie-container');
  if(cont.style.display === 'none' || cont.style.display === '') {
    cont.style.display = 'block';
    updatePie();
  } else {
    cont.style.display = 'none';
  }
}

function updatePie(){
  const counts = {'ğŸ˜†':0,'ğŸ˜­':0,'ğŸ˜´':0,'ğŸ¤®':0,'ğŸ˜Š':0,'ğŸ˜«':0,'ğŸ˜¡':0};
  const monthPrefix = `${currentYear}-${currentMonth+1}`;
  Object.keys(moodData).forEach(k=>{
    if(k.startsWith(monthPrefix)){
      moodData[k].forEach(m=>{ if(counts.hasOwnProperty(m.emoji)) counts[m.emoji]++; });
    }
  });
  const labels = Object.keys(counts);
  const data = Object.values(counts);
  if(pieChart) pieChart.destroy();
  const ctx = document.getElementById('moodPie').getContext('2d');
  pieChart = new Chart(ctx, {
    type:'pie',
    data:{
      labels: labels,
      datasets:[{
        data: data,
        backgroundColor: labels.map(l => moodColors[l])
      }]
    },
    options:{ responsive:true, plugins:{legend:{position:'bottom'}} }
  });
}

/* -------------------------
   NOTEBOOK (sections + notes)
   -------------------------*/

let notebookData = JSON.parse(localStorage.getItem('notebookNotebook')||'[]');
let sectionId = notebookData.length ? notebookData[notebookData.length-1].id : 0;

function saveNotebook(){ localStorage.setItem('notebookNotebook', JSON.stringify(notebookData)); }

function addSection(){
  sectionId++;
  notebookData.push({ id: sectionId, title: 'New Section', notes: [], open:true});
  renderNotebook();
  saveNotebook();
}

function deleteSection(id){
  notebookData = notebookData.filter(s=>s.id !== id);
  renderNotebook();
  saveNotebook();
}

function toggleSection(id){
  const s = notebookData.find(x=>x.id===id);
  if(!s) return;
  s.open = !s.open;
  renderNotebook();
  saveNotebook();
}

function renameSection(id, btn){
  const span = btn.previousElementSibling;
  span.contentEditable = true;
  span.focus();
  span.addEventListener('blur', ()=>{
    const sec = notebookData.find(x=>x.id===id);
    sec.title = span.innerText.trim() || 'New Section';
    span.contentEditable = false;
    renderNotebook();
    saveNotebook();
  }, {once:true});
}

function addNote(id){
  const s = notebookData.find(x=>x.id===id);
  s.notes.push('');
  renderNotebook();
  saveNotebook();
}

function deleteNote(sectionId, noteIndex){
  const s = notebookData.find(x=>x.id===sectionId);
  s.notes.splice(noteIndex,1);
  renderNotebook();
  saveNotebook();
}

function updateNote(sectionId, noteIndex, el){
  const s = notebookData.find(x=>x.id===sectionId);
  s.notes[noteIndex] = el.innerText;
  saveNotebook();
}

function renderNotebook(){
  const container = document.getElementById('sections');
  container.innerHTML = '';
  notebookData.forEach(sec=>{
    const secEl = document.createElement('div');
    secEl.className = 'section';

    const notesHTML = sec.notes.map((n,i)=>`
      <div class="note">
        <button class="note-delete" onclick="deleteNote(${sec.id},${i})">âŒ</button>
        <div class="note-content" contenteditable="true" oninput="updateNote(${sec.id},${i}, this)">${escapeHtml(n)}</div>
      </div>
    `).join('');

    secEl.innerHTML = `
      <div class="section-header">
        <span class="section-title">${escapeHtml(sec.title)}</span>
        <div>
          <button class="rename-btn" onclick="renameSection(${sec.id}, this)">Rename</button>
          <button class="toggle-btn" onclick="toggleSection(${sec.id})">Toggle</button>
          <button class="delete-btn" onclick="deleteSection(${sec.id})">Delete</button>
          <button class="add-note-btn" onclick="addNote(${sec.id})">+ Note</button>
        </div>
      </div>
      <div class="notes" style="display:${sec.open ? 'block' : 'none'}">
        ${notesHTML}
      </div>
    `;
    container.appendChild(secEl);
    // re-initialize contenteditable values safely (innerHTML already inserted)
  });
}

/* small helper to avoid injecting raw HTML when rendering note content */
function escapeHtml(text){
  if(!text) return '';
  return text
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'","&#039;");
}

/* initialize sample if empty */
if(notebookData.length===0){
  notebookData.push({ id: ++sectionId, title: 'My Notes', notes: ['Welcome! Click + Note to add notes.'], open:true});
  saveNotebook();
}

/* initial render */
renderCalendar();
renderNotebook();

/* if pie container visible initially update */
updatePie();

/* expose some functions to console (handy) */
window._debug = { moodData, notebookData, spawnFalling };

/* Ensure user data saved on unload */
window.addEventListener('beforeunload', ()=>{
  saveMoodData();
  saveNotebook();
});
</script>

</body>
</html>
